---
// 返回顶部按钮组件
---

<button
  id="back-to-top-button"
  class="back-to-top"
  aria-label="返回顶部"
  title="返回顶部"
  type="button"
>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="18 15 12 9 6 15"></polyline>
  </svg>
</button>

<script is:inline>
  (function() {
    // 确保只初始化一次
    if (window.backToTopInitialized) return;
    window.backToTopInitialized = true;

    function initBackToTop() {
      const button = document.getElementById('back-to-top-button');
      if (!button) return;

      // 获取滚动位置（优先检查 body）
      function getScrollTop() {
        return document.body.scrollTop ||
               document.documentElement.scrollTop ||
               window.scrollY ||
               window.pageYOffset || 0;
      }

      // 检查滚动并更新按钮状态
      function checkScroll() {
        const scrollTop = getScrollTop();

        if (scrollTop > 300) {
          button.classList.add('visible');
        } else {
          button.classList.remove('visible');
        }
      }

      // 点击返回顶部
      button.addEventListener('click', function(e) {
        e.preventDefault();

        // 自定义平滑滚动动画
        var start = getScrollTop();
        var startTime = performance.now();
        var duration = 600; // 600ms 动画时长

        function easeInOutCubic(t) {
          return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;
        }

        function animateScroll(currentTime) {
          var elapsed = currentTime - startTime;
          var progress = Math.min(elapsed / duration, 1);
          var easing = easeInOutCubic(progress);
          var currentScroll = start * (1 - easing);

          document.body.scrollTop = currentScroll;
          document.documentElement.scrollTop = currentScroll;

          if (progress < 1) {
            requestAnimationFrame(animateScroll);
          }
        }

        requestAnimationFrame(animateScroll);
      });

      // 使用轮询检测滚动（因为滚动事件在此页面不触发）
      let lastScroll = -1;
      setInterval(function() {
        const currentScroll = getScrollTop();
        if (currentScroll !== lastScroll) {
          lastScroll = currentScroll;
          checkScroll();
        }
      }, 150); // 每 150ms 检查一次，平衡性能和响应速度

      // 初始检查
      checkScroll();
    }

    // 立即执行
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initBackToTop);
    } else {
      initBackToTop();
    }
  })();
</script>

<style>
  .back-to-top {
    position: fixed;
    right: 2rem;
    bottom: 2rem;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--color-800);
    border: 1px solid var(--color-700);
    color: var(--color-200);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 1000;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

    /* 默认隐藏 */
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
  }

  .back-to-top:hover {
    background: var(--color-700);
    color: var(--color-100);
    transform: translateY(0) scale(1.05);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
  }

  .back-to-top:active {
    transform: translateY(0) scale(0.95);
  }

  /* 显示状态 */
  .back-to-top.visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .back-to-top svg {
    width: 24px;
    height: 24px;
    stroke-width: 2.5;
  }

  /* 响应式：移动端 */
  @media (max-width: 767px) {
    .back-to-top {
      right: 1rem;
      bottom: 1rem;
      width: 44px;
      height: 44px;
    }

    .back-to-top svg {
      width: 22px;
      height: 22px;
    }
  }

  /* 响应式：平板端 */
  @media (max-width: 1023px) {
    .back-to-top {
      right: 1.5rem;
      bottom: 1.5rem;
    }
  }
</style>
